name: Auto Create Pull Request

on:
  push:
    branches:
      - main  # Change this to the default branch of your repository

jobs:
  create_pr:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Get the latest commit SHA
        run: |
          latest_commit=$(git rev-parse HEAD)
          echo "::set-output name=latest_commit::$latest_commit"

      - name: Set environment variables
        run: |
          latest_commit=${{ needs.create_pr.outputs.latest_commit }}
          commit_msg=$(git log --format=%B -n 1 $latest_commit)
          echo "PR_TITLE=Auto PR: $commit_msg" >> $GITHUB_ENV
          echo "PR_BODY=Automatically generated PR for commit $latest_commit" >> $GITHUB_ENV

      - name: Create Pull Request
        run: |
          gh pr create --base main --head $latest_commit --title "$PR_TITLE" --body "$PR_BODY"
        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
