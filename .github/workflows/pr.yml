name: Auto Create PRs

on:
  push:
    branches:
      - main

jobs:
  createPR:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Create PRs for each commit
        run: |
          IFS=$'\n'
          for commit in $(git log --format=%H); do
            echo "Creating PR for commit: $commit"
            git checkout -b "auto-pr-branch-$commit" $commit
            echo "Changes for commit $commit" > description.txt
            git add description.txt
            git commit --amend --no-edit
            git push origin "auto-pr-branch-$commit"
            
            gh pr create --base main --head "auto-pr-branch-$commit" --title "Auto PR for commit $commit" --body "$(cat description.txt)"
          done

